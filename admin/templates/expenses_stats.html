<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bot Admin - Th·ªëng k√™ Giao d·ªãch</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
      .nav-links { margin-bottom: 16px; }
      .nav-links a { color: #0d6efd; text-decoration: none; margin-right: 16px; }
      .nav-links a:hover { text-decoration: underline; }
      .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px,1fr)); gap: 12px; margin-bottom: 32px; }
      .stat-item { border: 1px solid #eee; border-radius: 8px; padding: 16px; background: #fafafa; text-align: center; }
      .stat-number { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
      .stat-label { color: #666; font-size: 0.9em; }
      .section { margin-bottom: 32px; }
      .section h2 { border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 16px; }
      .time-chart { display: grid; grid-template-columns: repeat(12, 1fr); gap: 4px; margin: 16px 0; }
      .time-bar { background: #007bff; height: 100px; display: flex; align-items: end; justify-content: center; }
      .time-bar span { color: white; font-size: 0.8em; writing-mode: vertical-rl; text-orientation: mixed; }
      .day-chart { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin: 16px 0; }
      .day-item { border: 1px solid #eee; border-radius: 4px; padding: 8px; text-align: center; background: #f8f9fa; }
      .day-header { font-weight: 600; color: #666; }
      .day-count { font-size: 18px; font-weight: 700; color: #007bff; }
      .day-amount { font-size: 0.9em; color: #666; }
      .highlight { background: #fff3cd; border-color: #ffeaa7; }
      .warning { background: #f8d7da; border-color: #f5c6cb; }
      .success { background: #d4edda; border-color: #c3e6cb; }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Th·ªëng k√™ Giao d·ªãch</h1>
      <div>
        <a href="/expenses">‚Üê Quay l·∫°i</a>
      </div>
    </div>

    <div class="nav-links">
      <a href="/">Dashboard</a>
      <a href="/expenses">Qu·∫£n l√Ω giao d·ªãch</a>
      <a href="/users">Users</a>
      <a href="/logs">Logs</a>
    </div>

    <!-- Th·ªëng k√™ theo th·ªùi gian -->
    <div class="section">
      <h2>üìä Th·ªëng k√™ theo th·ªùi gian</h2>
      <p class="muted">S·ªë l∆∞·ª£ng giao d·ªãch trong c√°c kho·∫£ng th·ªùi gian kh√°c nhau</p>
      
      <div class="stats-grid">
        {% for stat in stats %}
        <div class="stat-item {% if stat.count > 0 and stat.time_range in ['5 minutes', '15 minutes', '30 minutes'] %}warning{% elif stat.count > 0 and stat.time_range in ['1 hour', '3 hours'] %}highlight{% elif stat.count > 0 %}success{% endif %}">
          <div class="stat-number">{{ stat.count }}</div>
          <div class="stat-label">{{ stat.label }}</div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Bi·ªÉu ƒë·ªì theo gi·ªù trong ng√†y -->
    <div class="section">
      <h2>üïê Ho·∫°t ƒë·ªông theo gi·ªù (7 ng√†y g·∫ßn nh·∫•t)</h2>
      <p class="muted">S·ªë l∆∞·ª£ng giao d·ªãch theo t·ª´ng gi·ªù trong ng√†y</p>
      
      <div class="time-chart">
        {% for hour in range(24) %}
        {% set hour_data = hourly_stats | selectattr("hour", "equalto", hour | string) | first %}
        {% if hour_data %}
        <div class="time-bar" style="height: {{ (hour_data.count / (hourly_stats | map(attribute="count") | max)) * 100 }}px;">
          <span>{{ hour_data.count }}</span>
        </div>
        {% else %}
        <div class="time-bar" style="height: 10px; background: #eee;">
          <span>0</span>
        </div>
        {% endif %}
        {% endfor %}
      </div>
      
      <div style="text-align: center; margin-top: 8px; color: #666;">
        <small>0h ‚Üí 23h</small>
      </div>
      
      <div style="margin-top: 16px;">
        <h4>Chi ti·∫øt theo gi·ªù:</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px;">
          {% for hour_data in hourly_stats %}
          <div class="day-item">
            <div class="day-header">{{ hour_data.hour }}:00</div>
            <div class="day-count">{{ hour_data.count }}</div>
            <div class="day-amount">{{ "{:,.0f}".format(hour_data.total_amount or 0) }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Th·ªëng k√™ theo ng√†y trong tu·∫ßn -->
    <div class="section">
      <h2>üìÖ Ho·∫°t ƒë·ªông theo ng√†y (30 ng√†y g·∫ßn nh·∫•t)</h2>
      <p class="muted">S·ªë l∆∞·ª£ng giao d·ªãch theo t·ª´ng ng√†y trong tu·∫ßn</p>
      
      <div class="day-chart">
        <div class="day-item day-header">CN</div>
        <div class="day-item day-header">T2</div>
        <div class="day-item day-header">T3</div>
        <div class="day-item day-header">T4</div>
        <div class="day-item day-header">T5</div>
        <div class="day-item day-header">T6</div>
        <div class="day-item day-header">T7</div>
        
        {% for day in range(7) %}
        {% set day_data = daily_stats | selectattr("day_of_week", "equalto", day | string) | list %}
        {% set total_count = day_data | sum(attribute="count") %}
        {% set total_amount = day_data | sum(attribute="total_amount") %}
        <div class="day-item">
          <div class="day-count">{{ total_count }}</div>
          <div class="day-amount">{{ "{:,.0f}".format(total_amount or 0) }}</div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Th√¥ng tin v·ªÅ kh·∫£ nƒÉng ho√†n t√°c -->
    <div class="section">
      <h2>‚ö†Ô∏è L∆∞u √Ω v·ªÅ Ho√†n t√°c Giao d·ªãch</h2>
      <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 16px;">
        <h4>Khuy·∫øn ngh·ªã:</h4>
        <ul>
          <li><strong>Giao d·ªãch trong 30 ph√∫t:</strong> C√≥ th·ªÉ ho√†n t√°c an to√†n, √≠t ·∫£nh h∆∞·ªüng</li>
          <li><strong>Giao d·ªãch trong 1-3 gi·ªù:</strong> C·∫ßn c√¢n nh·∫Øc k·ªπ tr∆∞·ªõc khi ho√†n t√°c</li>
          <li><strong>Giao d·ªãch trong 24 gi·ªù:</strong> Ch·ªâ ho√†n t√°c khi th·ª±c s·ª± c·∫ßn thi·∫øt</li>
          <li><strong>Giao d·ªãch c≈© h∆°n:</strong> Kh√¥ng n√™n ho√†n t√°c v√¨ c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn t√≠nh to√°n n·ª£</li>
        </ul>
        
        <h4>L∆∞u √Ω:</h4>
        <ul>
          <li>Ho√†n t√°c giao d·ªãch s·∫Ω x√≥a vƒ©nh vi·ªÖn t·∫•t c·∫£ d·ªØ li·ªáu li√™n quan</li>
          <li>C√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn t√≠nh to√°n n·ª£ v√† chi ti√™u c·ªßa nh√≥m</li>
          <li>N√™n th√¥ng b√°o cho c√°c th√†nh vi√™n li√™n quan tr∆∞·ªõc khi ho√†n t√°c</li>
        </ul>
      </div>
    </div>

    <script>
      // Highlight c√°c giao d·ªãch g·∫ßn ƒë√¢y
      document.addEventListener('DOMContentLoaded', function() {
        const warningItems = document.querySelectorAll('.warning');
        warningItems.forEach(function(item) {
          item.style.animation = 'pulse 2s infinite';
        });
      });
    </script>
    
    <style>
      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
      }
    </style>
  </body>
</html>
